<!DOCTYPE html>
<html>
<head>
    <title>Conversational AI with Amazon Nova 2 Sonic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/nova-icon.png">
    <link rel="stylesheet" href="/src/style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div id="app">
        <header class="app-header">
            <h1 class="app-title">
                <img src="/nova-icon.png" alt="Nova" class="header-icon" width="32" height="32">
                Amazon Nova 2 Sonic
            </h1>
            <div class="header-controls">
                <div id="connection-status" class="connection-status" title="Connection status">
                    <span class="connection-dot"></span>
                    <span class="connection-text">Connected</span>
                </div>
                <div id="session-timer" class="session-timer hidden">
                    <svg class="timer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="9"></circle>
                        <path d="M12 7v5l3 2"></path>
                    </svg>
                    <span id="session-time">00:00</span>
                </div>
                <div id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                    <svg class="theme-icon moon-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
                    <svg class="theme-icon sun-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <span class="theme-toggle-knob"></span>
                </div>
                <button id="settings-toggle" class="icon-btn settings-btn" aria-label="Settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="4" y1="6" x2="20" y2="6"></line>
                        <line x1="4" y1="12" x2="20" y2="12"></line>
                        <line x1="4" y1="18" x2="20" y2="18"></line>
                        <circle cx="8" cy="6" r="2" fill="currentColor"></circle>
                        <circle cx="16" cy="12" r="2" fill="currentColor"></circle>
                        <circle cx="10" cy="18" r="2" fill="currentColor"></circle>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Disconnect Confirmation Modal -->
        <div id="disconnect-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="modal-content">
                <div class="modal-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 9v4"></path>
                        <path d="M12 17h.01"></path>
                        <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path>
                    </svg>
                </div>
                <h3 id="modal-title" class="modal-title">End conversation?</h3>
                <p class="modal-message">Your current session will be disconnected.</p>
                <div class="modal-actions">
                    <button id="disconnect-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                    <button id="disconnect-confirm" class="modal-btn modal-btn-primary">End Session</button>
                </div>
            </div>
        </div>

        <div id="settings-overlay" class="settings-overlay"></div>
        <div id="settings-panel" class="settings-panel">
            <div class="settings-header">
                <h2>Configuration</h2>
                <button id="settings-close" class="close-btn">&times;</button>
            </div>
            <div class="settings-content">

                <details class="settings-accordion" open>
                    <summary>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"></path>
                        </svg>
                        System Prompt
                    </summary>
                    <div class="accordion-content">
                        <p class="section-description">Define the assistant's personality and behavior.</p>
                        <div class="setting-item">
                            <label class="settings-label">Preset</label>
                            <div class="custom-select" data-id="prompt-preset" data-value="custom">
                                <div class="custom-select-trigger">
                                    <span class="custom-select-value">Custom</span>
                                    <div class="custom-select-arrow">
                                        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </div>
                                </div>
                                <div class="custom-select-options">
                                    <div class="custom-select-option selected" data-value="custom">Custom</div>
                                    <div class="custom-select-option" data-value="default">Friendly Chat</div>
                                    <div class="custom-select-option" data-value="insurance_service">Insurance Customer Service</div>
                                    <div class="custom-select-option" data-value="intelligent_assistant">Intelligent Assistant</div>
                                    <div class="custom-select-option" data-value="tutor">Math Tutor</div>
                                </div>
                            </div>
                        </div>
                        <textarea id="system-prompt" class="settings-textarea" placeholder="Add system prompts"></textarea>
                    </div>
                </details>

                <details class="settings-accordion" open>
                    <summary>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="1"></circle>
                            <path d="M12 2a3 3 0 00-3 3v4a3 3 0 006 0V5a3 3 0 00-3-3z"></path>
                            <path d="M19 10v2a7 7 0 01-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="22"></line>
                        </svg>
                        Voice &amp; Response
                    </summary>
                    <div class="accordion-content">
                        <p class="section-description">Configure voice output and response timing.</p>
                        <div class="setting-item">
                            <label class="settings-label">Voice</label>
                            <div class="custom-select" data-id="voice-type" data-value="tiffany">
                                <div class="custom-select-trigger">
                                    <span class="custom-select-value">Tiffany</span>
                                    <div class="custom-select-arrow">
                                        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </div>
                                </div>
                                <div class="custom-select-options">
                                    <div class="custom-select-option selected" data-value="tiffany">Tiffany (Female)</div>
                                    <div class="custom-select-option" data-value="matthew">Matthew (Male)</div>
                                </div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label class="settings-label">Response timing</label>
                            <div class="custom-select has-description" data-id="response-timing" data-value="medium">
                                <div class="custom-select-trigger">
                                    <span class="custom-select-value">Medium</span>
                                    <div class="custom-select-arrow">
                                        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </div>
                                </div>
                                <div class="custom-select-options">
                                    <div class="custom-select-option" data-value="fast">
                                        <span class="option-label">Fast</span>
                                        <span class="option-description">Quick replies after brief pauses (~1.5s)</span>
                                    </div>
                                    <div class="custom-select-option selected" data-value="medium">
                                        <span class="option-label">Medium</span>
                                        <span class="option-description">Natural pacing for conversations (~1.75s)</span>
                                    </div>
                                    <div class="custom-select-option" data-value="slow">
                                        <span class="option-label">Slow</span>
                                        <span class="option-description">Longer pauses for thoughtful responses (~2s)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label class="settings-label">Output audio quality</label>
                            <div class="custom-select has-description" data-id="output-sample-rate" data-value="24000">
                                <div class="custom-select-trigger">
                                    <span class="custom-select-value">24 kHz</span>
                                    <div class="custom-select-arrow">
                                        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </div>
                                </div>
                                <div class="custom-select-options">
                                    <div class="custom-select-option" data-value="8000">
                                        <span class="option-label">8 kHz</span>
                                        <span class="option-description">Low bandwidth, telephony quality</span>
                                    </div>
                                    <div class="custom-select-option" data-value="16000">
                                        <span class="option-label">16 kHz</span>
                                        <span class="option-description">Standard quality, balanced</span>
                                    </div>
                                    <div class="custom-select-option selected" data-value="24000">
                                        <span class="option-label">24 kHz</span>
                                        <span class="option-description">High quality audio output</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>

                <details class="settings-accordion">
                    <summary>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <line x1="4" y1="21" x2="4" y2="14"></line>
                            <line x1="4" y1="10" x2="4" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12" y2="3"></line>
                            <line x1="20" y1="21" x2="20" y2="16"></line>
                            <line x1="20" y1="12" x2="20" y2="3"></line>
                            <line x1="1" y1="14" x2="7" y2="14"></line>
                            <line x1="9" y1="8" x2="15" y2="8"></line>
                            <line x1="17" y1="16" x2="23" y2="16"></line>
                        </svg>
                        Inference Settings
                    </summary>
                    <div class="accordion-content">
                        <p class="section-description">Fine-tune model behavior and response generation.</p>
                        <div class="setting-item slider-item">
                            <div class="slider-header">
                                <label class="settings-label">Temperature</label>
                                <input type="number" id="temperature-value" class="slider-value-input" value="1" min="0" max="1" step="0.1">
                            </div>
                            <input type="range" id="temperature" class="settings-slider" min="0" max="1" step="0.1" value="1">
                        </div>
                        <div class="setting-item slider-item">
                            <div class="slider-header">
                                <label class="settings-label">Top P</label>
                                <input type="number" id="top-p-value" class="slider-value-input" value="0.9" min="0" max="1" step="0.1">
                            </div>
                            <input type="range" id="top-p" class="settings-slider" min="0" max="1" step="0.1" value="0.9">
                        </div>
                        <div class="setting-item slider-item">
                            <div class="slider-header">
                                <label class="settings-label">Response length</label>
                                <input type="number" id="max-tokens-value" class="slider-value-input" value="2048" min="256" max="4096" step="256">
                            </div>
                            <input type="range" id="max-tokens" class="settings-slider" min="256" max="4096" step="256" value="2048">
                        </div>
                    </div>
                </details>

                <details class="settings-accordion">
                    <summary>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                            <path d="M19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"></path>
                        </svg>
                        Audio Settings
                    </summary>
                    <div class="accordion-content">
                        <p class="section-description">Adjust audio playback buffer for optimal performance.</p>
                        <div class="setting-item slider-item">
                            <div class="slider-header">
                                <label class="settings-label">Initial buffer (ms)</label>
                                <input type="number" id="audio-buffer-value" class="slider-value-input" value="200" min="0" max="1000" step="100">
                            </div>
                            <input type="range" id="audio-buffer" class="settings-slider" min="0" max="1000" step="100" value="200">
                            <p class="setting-hint">Lower = faster response, higher = smoother playback</p>
                        </div>
                    </div>
                </details>

                <details class="settings-accordion" open>
                    <summary>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"></path>
                        </svg>
                        Tools
                    </summary>
                    <div class="accordion-content">
                        <p class="section-description">Enable or disable tools for the assistant to use during conversations.</p>
                        <div id="tools-list" class="tools-list">
                            <div class="tools-loading">Loading tools...</div>
                        </div>
                    </div>
                </details>

                <details class="settings-accordion">
                    <summary>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"></path>
                        </svg>
                        AWS Region
                    </summary>
                    <div class="accordion-content">
                        <p class="section-description">Select the AWS region for API calls.</p>
                        <div class="custom-select" data-id="aws-region" data-value="ap-northeast-1">
                            <div class="custom-select-trigger">
                                <span class="custom-select-value">Asia Pacific (Tokyo)</span>
                                <div class="custom-select-arrow">
                                    <svg width="12" height="12" viewBox="0 0 12 12"><path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </div>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option selected" data-value="ap-northeast-1">Asia Pacific (Tokyo)</div>
                                <div class="custom-select-option" data-value="us-east-1">US East (N. Virginia)</div>
                                <div class="custom-select-option" data-value="us-west-2">US West (Oregon)</div>
                                <div class="custom-select-option" data-value="eu-north-1">Europe (Stockholm)</div>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>

        <main class="main-content">
            <div class="voice-container">
                <canvas id="waveform-canvas" class="waveform-canvas"></canvas>
                <div class="button-wrapper">
                    <canvas id="ring-canvas" class="ring-canvas"></canvas>
                    <button id="voice-btn" class="voice-btn idle" aria-label="Start voice">
                    <svg class="mic-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2a3 3 0 00-3 3v7a3 3 0 006 0V5a3 3 0 00-3-3z"></path>
                        <path d="M19 10v2a7 7 0 01-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="22"></line>
                        <line x1="8" y1="22" x2="16" y2="22"></line>
                    </svg>
                    <svg class="stop-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                    </svg>
                    </button>
                </div>
                <div id="voice-status" class="voice-status"></div>
            </div>

            <p class="voice-hint hidden">Tap to start conversation</p>
            <div id="chat-container" class="chat-container">
                <div id="chat-empty-state" class="chat-empty-state">
                    <div class="empty-state-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"></path>
                        </svg>
                    </div>
                    <h3 class="empty-state-title">Ready to chat</h3>
                    <p class="empty-state-description">
                        Tap the microphone to start a voice conversation, or use the keyboard to type.
                    </p>
                    <div class="empty-state-hints">
                        <div class="hint-item">
                            <span class="hint-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"></path>
                                    <path d="M19 10v2a7 7 0 01-14 0v-2"></path>
                                    <line x1="12" y1="19" x2="12" y2="23"></line>
                                    <line x1="8" y1="23" x2="16" y2="23"></line>
                                </svg>
                            </span>
                            <span>Voice: Natural conversation</span>
                        </div>
                        <div class="hint-item">
                            <span class="hint-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                                    <line x1="6" y1="8" x2="6" y2="8"></line>
                                    <line x1="10" y1="8" x2="10" y2="8"></line>
                                    <line x1="14" y1="8" x2="14" y2="8"></line>
                                    <line x1="18" y1="8" x2="18" y2="8"></line>
                                    <line x1="6" y1="12" x2="6" y2="12"></line>
                                    <line x1="18" y1="12" x2="18" y2="12"></line>
                                    <line x1="8" y1="16" x2="16" y2="16"></line>
                                </svg>
                            </span>
                            <span>Text: Type your questions</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Typing Window -->
            <div id="typing-window" class="typing-window hidden">
                <div class="typing-input-wrapper">
                    <textarea id="text-input" class="text-input" placeholder="Type your message..." rows="1"></textarea>
                    <button id="send-text-btn" class="send-text-btn" aria-label="Send message">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                    <button id="hide-typing-btn" class="hide-typing-btn" aria-label="Hide typing window">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Keyboard Toggle Button -->
            <button id="keyboard-toggle" class="keyboard-toggle" aria-label="Toggle typing mode">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                    <line x1="6" y1="8" x2="6.01" y2="8"></line>
                    <line x1="10" y1="8" x2="10.01" y2="8"></line>
                    <line x1="14" y1="8" x2="14.01" y2="8"></line>
                    <line x1="18" y1="8" x2="18.01" y2="8"></line>
                    <line x1="6" y1="12" x2="6.01" y2="12"></line>
                    <line x1="10" y1="12" x2="10.01" y2="12"></line>
                    <line x1="14" y1="12" x2="14.01" y2="12"></line>
                    <line x1="18" y1="12" x2="18.01" y2="12"></line>
                    <line x1="8" y1="16" x2="16" y2="16"></line>
                </svg>
            </button>
        </main>
    </div>
    <script type="module" src="/src/main.js"></script>
    <script type="module" src="/src/typing.js"></script>
</body>
</html>
